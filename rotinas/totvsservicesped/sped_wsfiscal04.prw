#INCLUDE "PROTHEUS.CH"                                    
#INCLUDE "APWEBSRV.CH"

/* --------------------------------------------- INFORMACOES SOBRE EXPORTACOES */
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes das operacoes de exportacao indireta de produtosЁ
//Ё  NAO industrializados pelo estabelecimento emitente.       Ё
//Ё- Registro abrangido: 1110                                  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_EXPIND
	WSDATA ID_PART		AS STRING
	WSDATA MODELO		AS STRING
	WSDATA SERIE		AS STRING
	WSDATA NUMERO		AS STRING
	WSDATA DTEMISS		AS DATE
	WSDATA CHVNFE		AS STRING
	WSDATA NRMEMO		AS INTEGER
	WSDATA QTD			AS FLOAT
	WSDATA UM			AS STRING
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes dos documentos fiscais de exportacoes.Ё
//Ё- Registro abrangido: 1105                        Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_DFE
	WSDATA MODELO		AS STRING
	WSDATA SERIE		AS STRING
	WSDATA NUMERO		AS STRING
	WSDATA CHVNFE		AS STRING
	WSDATA DTEMISS		AS DATE
	WSDATA CODITEM		AS STRING
	WSDATA EXPIND		AS ARRAY OF STR_EXPIND
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes dos registros sobre exportacoes.Ё
//Ё- Registros abrangidos: 1100, 1105 e 1110   Ё
//юдддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_INFEXP
	WSDATA TPDOC		AS INTEGER	//0-Bloco com dados informados e 1-Bloco sem dados informados
	WSDATA NRODE		AS INTEGER
	WSDATA DTDE			AS DATE
	WSDATA NATEXP		AS INTEGER	//0-ExportaГЦo Direta ou 1-ExportaГЦo Indireta
	WSDATA NRORE		AS INTEGER
	WSDATA DTRE			AS DATE
	WSDATA CHCEMB		AS INTEGER
	WSDATA DTCHC		AS DATE
	WSDATA DTAVB		AS DATE
	WSDATA TPCHC		AS STRING	//Tipo de documento de carga da tabela SISCOMEX
	WSDATA PAIS			AS INTEGER
	WSDATA DFE			AS ARRAY OF STR_DFE
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддд©
//ЁDefinicao dos arrays de estruturasЁ
//юдддддддддддддддддддддддддддддддддды
WSSTRUCT SPED_INFEXP
	WSDATA ID_ENT		AS STRING
	WSDATA INFEXP		AS ARRAY OF STR_INFEXP
ENDWSSTRUCT

/* --------------------------------------------- INFORMACOES SOBRE CONTROLE DE CREDITOS FISCAIS */

//здддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes de utilizacao do credito fiscal.Ё
//Ё- Registro abrangido: 1210                  Ё
//юдддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_UTILCRD
	WSDATA TPUTIL		AS INTEGER	//0-DeduГЦo do ICMS normal, 1-CompensaГЦo de auto de infraГЦo, 2-TransferЙncia de crИdito, 3-RestituiГЦo de crИdito em moeda, 4-DeduГЦo do ICMS SubstituiГЦo TributАria apurado no mЙs (Substituto), 5-CompensaГЦo com documento de arrecadaГЦo √ (SubstituiГЦo TributАria) e 9-Outros.
	WSDATA NRDOC		AS STRING
	WSDATA VLRCRD		AS FLOAT
ENDWSSTRUCT

//зддддддддддддддддддддддддддддддддддд©
//ЁInformacoes dos creditos fiscais.  Ё
//Ё- Registros abrangidos: 1200 e 1210Ё
//юддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_CCF
	WSDATA CODAJ		AS STRING
	WSDATA SLDCRD		AS FLOAT
	WSDATA CRDAPR		AS FLOAT
	WSDATA CRDREC		AS FLOAT
	WSDATA SLDCRDFIM	AS FLOAT
	WSDATA UTILCRD		AS ARRAY OF STR_UTILCRD
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддд©
//ЁDefinicao dos arrays de estruturasЁ
//юдддддддддддддддддддддддддддддддддды
WSSTRUCT SPED_CCF
	WSDATA ID_ENT		AS STRING
	WSDATA CCF			AS ARRAY OF STR_CCF
ENDWSSTRUCT

/* --------------------------------------------- INFORMACOES SOBRE MOVIMENTACOES DE COMBUSTIVEIS */

//зддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes sobre o volume de vendas.Ё
//Ё- Abrange registro 1310              Ё
//юддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_VOLVENDAS
	WSDATA NUMTQ		AS STRING
	WSDATA BOMBA		AS STRING
	WSDATA BICO			AS INTEGER
	WSDATA VLRFECH		AS FLOAT
	WSDATA VLRABER		AS FLOAT
	WSDATA AFERICOES	AS FLOAT
	WSDATA VOLVENDLT	AS FLOAT
ENDWSSTRUCT

//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes sobre a conciliacao do estoque de combustiveis.Ё
//Ё- Abrange o registro 1300.                                 Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_CONSCEST
	WSDATA NUMTQ		AS STRING
	WSDATA FECHFIS		AS FLOAT
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes sobre movimentacoes de combustiveis.Ё
//Ё- Abrange os registros: 1300, 1310 e 1320.      Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_MOVCOMB
	WSDATA CODITEM		AS STRING
	WSDATA DTFECH		AS DATE
	WSDATA NRINTER		AS INTEGER
	WSDATA ESTAB		AS FLOAT
	WSDATA TOTENTR		AS FLOAT
	WSDATA PRCBOMBA		AS FLOAT	//Campo utilizado para calcular o campo 09-VAL_SAIDAS(layout)
	WSDATA VLRPERDA		AS FLOAT
	WSDATA VLRGANHO		AS FLOAT
	WSDATA VOLVENDAS	AS ARRAY OF STR_VOLVENDAS
	WSDATA CONSCEST		AS ARRAY OF STR_CONSCEST
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддд©
//ЁDefinicao dos arrays de estruturasЁ
//юдддддддддддддддддддддддддддддддддды
WSSTRUCT SPED_MOVCOMB
	WSDATA ID_ENT		AS STRING
	WSDATA MOVCOMB		AS ARRAY OF STR_MOVCOMB
ENDWSSTRUCT
	
/* --------------------------------------------- INFORMACOES SOBRE VALORES AGREGADOS */	

//здддддддддддддддддддддддддддддддддддд©
//ЁInformacoes sobre valores agregados.Ё
//Ё- Abrange o registro 1400           Ё
//юдддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_VLRAGREG
	WSDATA CODITEM		AS STRING
	WSDATA MUN			AS STRING
	WSDATA VLR			AS FLOAT
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддд©
//ЁDefinicao dos arrays de estruturasЁ
//юдддддддддддддддддддддддддддддддддды
WSSTRUCT SPED_VLRAGREG
	WSDATA ID_ENT		AS STRING
	WSDATA VLRAGREG		AS ARRAY OF STR_VLRAGREG
ENDWSSTRUCT

/* --------------------------- INFORMACOES DE OPERACOES INTERESTADUAIS PELAS EMPRESAS DE ENERGIA ELETRICA SUJEITAS AO CONV.115 */	

//зддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁEstrutura base dos tributos dos documentos fiscais.Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_TRIBEE
	WSDATA TPTRIB								AS STRING 	//01=ICMS, 02=ICMS/ST, 03-IPI, 04=ISS, 05=PIS, 06=PIS/ST, 07=COFINS, 08=COFINS/ST, 09=IR, 10=PREVIDйNCIA, 11=FECP
	WSDATA CST									AS STRING
	WSDATA BASE									AS FLOAT
	WSDATA ALIQ									AS FLOAT	OPTIONAL
	WSDATA VLR									AS FLOAT
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes dos itens das notas fiscais/conta de fornecimento de energia eletrica.Ё
//Ё- Abrange os registros: 1500 e 1510                                               Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_ITEM
	WSDATA NUMITE		AS INTEGER
	WSDATA CODITEM		AS STRING
	WSDATA CODCLASS		AS STRING
	WSDATA QTD			AS FLOAT
	WSDATA UM			AS STRING
	WSDATA VLRTOTAL		AS FLOAT
	WSDATA VLRDESC		AS FLOAT OPTIONAL
	WSDATA CFOP			AS STRING
	WSDATA TPREC		AS STRING	OPTIONAL	//0=RECEITA PROPRIA, 1=RECEITA DE TERCEIROS (PARA OS MODELOS 06 e 28) OU 0=RECEITA PROPRIA - SERVICOS PRESTADOS, 1=RECEITA PROPRIA - COBRANCA DE DEBITOS, 2=RECEITA PROPRIA - VENDA DE MERCADORIAS, 3=RECEITA PROPRIA - VENDA DE SERVICO PRE-PAGO, 4=OUTRAS RECEITAS PROPRIAS, 5=RECEITA DE TERCEIROS(CO-FATURAMENTO), 9=OUTRAS RECEITAS DE TERCEIROS (PARA OS MODELOS 21 e 22)
	WSDATA ID_PARTREC	AS STRING	OPTIONAL
	WSDATA CTACONTABIL	AS STRING
	WSDATA TRIBEE		AS ARRAY OF STR_TRIBEE
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//ЁInformacoes das notas fiscais/conta de fornecimento de energia eletrica.Ё
//Ё- Abrange os registros: 1500 e 1510                                     Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
WSSTRUCT STR_NFCTAEE
	WSDATA TPOPER		AS STRING	//0=ENTRADA, 1=SAIDA
	WSDATA EMIT			AS STRING	//O=EMISSAO PROPRIA, 1=TERCEIROS
	WSDATA ID_PART		AS STRING
	WSDATA MODELO		AS STRING	//MODELO DO DOCUMENTO FISCAL CONFORME TABELA 4.1.1 DO LAYOUT COTEPE 11/2007
	WSDATA SITUACAO		AS STRING	//SITUACAO DO DOCUMENTO FISCAL CONFORME TABELA 4.1.2 DO LAYOUT COTEPE 11/2007
	WSDATA SERIE		AS STRING
	WSDATA SUBSERIE		AS STRING OPTIONAL
	WSDATA CODCONS		AS STRING
	WSDATA NUMERO		AS STRING
	WSDATA DTEMISS		AS DATE
	WSDATA DTENTSAI		AS DATE
	WSDATA VLRTOTAL		AS FLOAT
	WSDATA VLRDESC		AS FLOAT OPTIONAL
	WSDATA VLRFORCONS	AS FLOAT
	WSDATA VLRSERVNT	AS FLOAT OPTIONAL
	WSDATA VLRTERC		AS FLOAT
	WSDATA VLRDESP		AS FLOAT OPTIONAL
	WSDATA CODINF		AS STRING
	WSDATA ITEM			AS ARRAY OF STR_ITEM
ENDWSSTRUCT

//здддддддддддддддддддддддддддддддддд©
//ЁDefinicao dos arrays de estruturasЁ
//юдддддддддддддддддддддддддддддддддды
WSSTRUCT SPED_NFCTAEE
	WSDATA ID_ENT		AS STRING
	WSDATA NFCTAEE		AS ARRAY OF STR_NFCTAEE
ENDWSSTRUCT


//зддддддддддддддддддддддддд©
//ЁDefinicao do WEB SERVICE.Ё
//юддддддддддддддддддддддддды
WSSERVICE SPEDFISCALOUTRASINF ;
	DESCRIPTION "<b>ServiГo genИrico de administraГЦo do Sped Fiscal.</b><br><br>Este serviГo permite a administraГЦo das tabelas de outras informaГУes exigidas pelo FISCO e que nЦo se enquadram em nenhum dos serviГos do Sped Fiscal disponibilizados atИ o momento."  ;
	NAMESPACE "http://webservices.totvs.com.br/spedfiscaloutrasinf.apw"
	
	WSDATA USERTOKEN       				     		AS STRING
	WSDATA RETORNO        				     		AS BOOLEAN
	
	WSDATA INFEXP									AS SPED_INFEXP
	WSDATA CCF										AS SPED_CCF
	WSDATA MOVCOMB									AS SPED_MOVCOMB
	WSDATA VLRAGREG									AS SPED_VLRAGREG
	WSDATA NFCTAEE									AS SPED_NFCTAEE
	
	WSMETHOD FIS_INFEXP					   			DESCRIPTION "<b>MИtodo de administraГЦo do cadastro de informaГУes de exportaГЦo do Sped Fiscal.</b><br><br>Este mИtodo deve ser utilizado para informar ao Sped Fiscal as informaГУes de exportaГЦo direta ou indireta ocorridas no perМodo e que nЦo sЦo declaradas atravИs dos serviГos disponМveis atИ o momento.<br><br>OcorrЙncia:<br>Pode haver vАrios registros sobre exportaГЦo no perМodo.<br><br>ObservaГЦo:<br>Em seu nМvel imediatamente inferior, devemos informar todos os documentos de exportaГЦo vinculados, e em caso de exportaГЦo indireta de produtos nЦo industrializados pelo estabelecimento emitente, devemos informar o outro registro imediatamente inferior ao anterior."
	WSMETHOD FIS_CCF		  						DESCRIPTION "<b>MИtodo de administraГЦo do cadastro de informaГУes sobre o controle de crИditos fiscais de ICMS do Sped Fiscal.</b><br><br>Este mИtodo deve ser utilizado para informar ao Sped Fiscal as informaГУes de crИdito de ICMS e sua utilizaГЦo no perМodo e que nЦo sЦo declaradas atravИs dos serviГos disponМveis atИ o momento.<br><br>OcorrЙncia:<br>Pode haver vАrios registros sobre crИditos fiscais de ICMS no perМodo, desde que seja respeitado a chave de identificaГЦo do registro formada pelo campo 'CODAJ'.<br><br>ObservaГЦo:<br>Em seu nМvel imediatamente inferior, devemos informar a utilizaГЦo deste crИdito, podendo ser subdivido conforme opГУes do 'TPUTIL'."
	WSMETHOD FIS_MOVCOMB			  				DESCRIPTION	"<b>MИtodo de administraГЦo do cadastro de movimentaГУes de combustМveis do Sped Fiscal.</b><br><br>Este mИtodo deve ser utilizado para informar ao Sped Fiscal as informaГУes de movimentaГУes de combustМveis ocorridas no perМodo e que nЦo sЦo declaradas atravИs dos serviГos disponМveis atИ o momento.<br><br>OcorrЙncia:<br>Pode haver vАrios registros sobre movimentaГУes de combustМveis no perМodo, desde que se respeite a chave de gravaГЦo das informaГУes atravИs dos campos 'CODITEM + DTFECH' deste mИtodo.<br><br>ObservaГЦo:<br>Em seus nМveis imediatamente inferiores, podemos informar o volume de vendas e a conciliaГЦo de estoque fМsico por tanque."
	WSMETHOD FIS_VLRAGREG							DESCRIPTION	"<b>MИtodo de administraГЦo do cadastro de valores agregados do Sped Fiscal.</b><br><br>Este mИtodo deve ser utilizado para informar ao Sped Fiscal o calculo do valor adicional por municМpio, sendo utilizado para subsidiar cАlculo de Мndices de participaГЦo. DeverА ser preenchido pelo seguintes contribuintes:<br><br>-Empresas que adquirirem, diretamente de produtor, produtos agrМcolas, pastoris, extrativos minerais, pescados ou outros produtos extrativos ou agropecuАrio.<br>-Empresas que emitem documentos fiscais de entrada de produГЦo prСpria, de produtos agrМcolas, pastoris, extrativos minerais, pescados ou outros produtos extrativos ou agropecuАrio;<br>-Empresas de transporte intermunicipal e interestadual;<br>-Empresas de telecomunicaГЦo e comunicaГЦo;<br>-Empresas de energia;<br>-ServiГo de utilidade pЗblica de distribuiГЦo de Аgua."
	WSMETHOD FIS_NFCTAEE							DESCRIPTION "<b>MИtodo de administraГЦo do cadastro das notas fiscais/contas de energia elИtrica do Sped Fiscal.</b><br><br>Este mИtodo deve ser utilizado para informar ao Sped Fiscal as informaГУes das operaГУes interestaduais efetuadas pelas empresas de energia elИtrica, que emitem os documentos em via Зnica conforme Conv. 115/03.<br><br>OcorrЙncia:<br>Pode haver vАrios registros de notas fiscais/conta de energia elИtrica no perМodo, desde que seja respeitado a chave de identificaГЦo do registro formada pelos campos 'TPOPER + EMIT + ID_PART + MODELO + SITUACAO + SERIE + SUBSERIE + CODCONS + NUMERO + DT_EMISSAO + DT_ENTSAI' da estrutura deste mИtodo.<br><br>ObservaГЦo:<br>Em seu nМvel imediatamente inferior (ITEM) devemos informar os itens da nota fiscal/conta de energia eletrМca, que deverА conter caso seja calculado os tributos (ICMS, ICMS/ST, PIS e COFINS) amarrados no nМvel imediatamente inferior ao 'ITEM', identificado como 'TRIBEE'. Os tributos sЦo referenciados atravИs dos cСdigos:<br><br>- 01=ICMS;<br>- 02=ICMS/ST;<br>- 03=IPI;<br>- 04=ISS;<br>- 05=PIS;<br>- 06=PIS/ST;<br>- 07=COFINS;<br>- 08=COFINS/ST;<br>- 09=IR;<br>- 10=PREVIDйNCIA."
ENDWSSERVICE

WSMETHOD FIS_INFEXP WSRECEIVE USERTOKEN,INFEXP WSSEND RETORNO WSSERVICE SPEDFISCALOUTRASINF

WSMETHOD FIS_CCF WSRECEIVE USERTOKEN,CCF WSSEND RETORNO WSSERVICE SPEDFISCALOUTRASINF

WSMETHOD FIS_MOVCOMB WSRECEIVE USERTOKEN,MOVCOMB WSSEND RETORNO WSSERVICE SPEDFISCALOUTRASINF

WSMETHOD FIS_VLRAGREG WSRECEIVE USERTOKEN,VLRAGREG WSSEND RETORNO WSSERVICE SPEDFISCALOUTRASINF

WSMETHOD FIS_NFCTAEE WSRECEIVE USERTOKEN,NFCTAEE WSSEND RETORNO WSSERVICE SPEDFISCALOUTRASINF

